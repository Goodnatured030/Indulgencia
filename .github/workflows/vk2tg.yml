name: VK ‚Üí Telegram

on:
  workflow_dispatch:     # –∑–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é
  schedule:              # –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
    - cron: '*/5 * * * *'

permissions:
  contents: write         # –Ω—É–∂–Ω–æ –¥–ª—è git commit/push —Ñ–∞–π–ª–∞ last_id.txt

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
    - name: üîΩ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      uses: actions/checkout@v3

    - name: üîß –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      run: |
        pip install vk_api
        pip install python-telegram-bot==13.15

    - name: ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç
      env:
        VK_TOKEN: ${{ secrets.VK_TOKEN }}
        TG_TOKEN: ${{ secrets.TG_TOKEN }}
        CHAT_ID: ${{ secrets.CHAT_ID }}
      run: |
        python main.py

    - name: üîº –ó–∞–ø—É—à–∏—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π last_id.txt
      run: |
        git config user.name "vk2tg-bot"
        git config user.email "bot@vk2tg.com"
        git add last_id.txt
        git commit -m "update last_id"
        git push
      continue-on-error: true